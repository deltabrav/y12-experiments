<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Condition Experiment</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            overflow: hidden;
        }
        
        .main-container {
            display: flex;
            max-width: 1200px;
            gap: 20px;
            align-items: flex-start;
        }
        
        #experiment-container {
            width: 400px;
            height: 400px;
            border: 2px solid #333;
            background-color: white;
            position: relative;
            flex-shrink: 0;
        }
        
        #square {
            width: 106px; /* Scaled down proportionally */
            height: 106px;
            border: 3px solid black;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: transparent;
        }
        
        #red-dot {
            width: 8px;
            height: 8px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        #letter {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: blue;
            display: none;
        }
        
        .controls-panel {
            flex: 1;
            max-width: 350px;
            padding: 10px;
        }
        
        #instructions {
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        #results {
            margin-top: 15px;
            font-weight: bold;
            font-size: 14px;
        }
        
        button {
            padding: 8px 16px;
            font-size: 14px;
            margin: 3px;
            cursor: pointer;
        }
        
        #timer {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        #status {
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        h1 {
            font-size: 20px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Dual Condition Tracking Experiment</h1>
    
    <div id="instructions">
        <p><strong>Condition 1:</strong> Keep the red dot inside the square using arrow keys for 30 seconds.</p>
        <p><strong>Condition 2:</strong> Keep the red dot inside the square AND press the correct letter keys when they appear (must complete all 6 letters to finish).</p>
        <p>The red dot moves randomly. Use arrow keys to control it. Don't let it touch or cross the square outline!</p>
    </div>
    
    <button onclick="startCondition(1)">Start Condition 1</button>
    <button onclick="startCondition(2)">Start Condition 2</button>
    <button onclick="resetExperiment()" id="reset-btn" style="display: none;">Reset Experiment</button>
    
    <div id="timer"></div>
    <div id="status"></div>
    
    <div id="experiment-container">
        <div id="square"></div>
        <div id="red-dot"></div>
        <div id="letter"></div>
    </div>
    
    <div id="results"></div>
    
    <script>
        let gameState = {
            active: false,
            condition: 0,
            dotX: 200, // Center of smaller container
            dotY: 200,
            dotVelocityX: 0,
            dotVelocityY: 0,
            timeOutside: 0,
            startTime: 0,
            lastOutsideCheck: 0,
            timeLeft: 0,
            lettersCorrect: 0,
            currentLetter: '',
            letterTimer: 0,
            gameTimer: null,
            letterInterval: null,
            animationFrame: null,
            countdown: 0,
            countdownActive: false
        };
        
        const letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
        const squareLeft = 200 - 53; // Adjusted to center properly within square bounds
        const squareRight = 200 + 53;
        const squareTop = 200 - 53;
        const squareBottom = 200 + 53;
        
        function startCondition(condition) {
            gameState.condition = condition;
            gameState.dotX = 200;
            gameState.dotY = 200;
            gameState.dotVelocityX = 0;
            gameState.dotVelocityY = 0;
            gameState.timeOutside = 0;
            gameState.lettersCorrect = 0;
            gameState.currentLetter = '';
            gameState.timeLeft = condition === 1 ? 30 : null;
            gameState.countdown = 3;
            gameState.countdownActive = true;
            gameState.active = false; // Don't start game until countdown ends
            
            // Reset dot position visually
            const dot = document.getElementById('red-dot');
            dot.style.left = '200px';
            dot.style.top = '200px';
            
            document.getElementById('reset-btn').style.display = 'inline-block';
            document.getElementById('results').innerHTML = '';
            document.getElementById('letter').style.display = 'none';
            
            startCountdown();
        }
            
        function startCountdown() {
            updateDisplay();
            
            if (gameState.countdown > 0) {
                setTimeout(() => {
                    gameState.countdown--;
                    startCountdown();
                }, 1000);
            } else {
                // Countdown finished, start the actual game
                gameState.countdownActive = false;
                gameState.active = true;
                gameState.startTime = Date.now();
                gameState.lastOutsideCheck = Date.now();
                
                // Set random initial velocity
                gameState.dotVelocityX = (Math.random() - 0.5) * 2;
                gameState.dotVelocityY = (Math.random() - 0.5) * 2;
                
                updateDisplay();
                startGameLoop();
                
                if (gameState.condition === 2) {
                    startLetterSequence();
                }
            }
        }
        
        function startGameLoop() {
            if (gameState.condition === 1) {
                gameState.gameTimer = setInterval(() => {
                    gameState.timeLeft--;
                    updateDisplay();
                    
                    if (gameState.timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            } else {
                // Condition 2: only check for letter completion, but don't end immediately
                gameState.gameTimer = setInterval(() => {
                    updateDisplay();
                    
                    if (gameState.lettersCorrect >= 6) {
                        endGame();
                    }
                }, 100);
            }
            
            animate();
        }
        
        function animate() {
            if (!gameState.active) return;
            
            // Add random movement to dot
            gameState.dotVelocityX += (Math.random() - 0.5) * 0.35;
            gameState.dotVelocityY += (Math.random() - 0.5) * 0.35;
            
            // Limit velocity
            const maxVelocity = 2.1;
            gameState.dotVelocityX = Math.max(-maxVelocity, Math.min(maxVelocity, gameState.dotVelocityX));
            gameState.dotVelocityY = Math.max(-maxVelocity, Math.min(maxVelocity, gameState.dotVelocityY));
            
            // Update position
            gameState.dotX += gameState.dotVelocityX;
            gameState.dotY += gameState.dotVelocityY;
            
            // Keep dot within container bounds
            if (gameState.dotX < 4) {
                gameState.dotX = 4;
                gameState.dotVelocityX = Math.abs(gameState.dotVelocityX);
            }
            if (gameState.dotX > 396) {
                gameState.dotX = 396;
                gameState.dotVelocityX = -Math.abs(gameState.dotVelocityX);
            }
            if (gameState.dotY < 4) {
                gameState.dotY = 4;
                gameState.dotVelocityY = Math.abs(gameState.dotVelocityY);
            }
            if (gameState.dotY > 396) {
                gameState.dotY = 396;
                gameState.dotVelocityY = -Math.abs(gameState.dotVelocityY);
            }
            
            // Check if dot is outside square and track time
            checkSquareBoundary();
            
            // Update dot position
            const dot = document.getElementById('red-dot');
            dot.style.left = gameState.dotX + 'px';
            dot.style.top = gameState.dotY + 'px';
            
            gameState.animationFrame = requestAnimationFrame(animate);
        }
        
        function checkSquareBoundary() {
            const dotLeft = gameState.dotX - 4;
            const dotRight = gameState.dotX + 4;
            const dotTop = gameState.dotY - 4;
            const dotBottom = gameState.dotY + 4;
            
            const now = Date.now();
            const deltaTime = now - gameState.lastOutsideCheck;
            
            // Check if dot is touching or outside the square
            const isOutside = (dotLeft < squareLeft || dotRight > squareRight || 
                              dotTop < squareTop || dotBottom > squareBottom);
            
            if (isOutside) {
                gameState.timeOutside += deltaTime;
            }
            
            gameState.lastOutsideCheck = now;
        }
        
        function startLetterSequence() {
            let letterCount = 0;
            
            function showNextLetter() {
                if (letterCount >= 6 || !gameState.active) return;
                
                gameState.currentLetter = letters[Math.floor(Math.random() * letters.length)];
                
                // Position letter outside the square
                const letterEl = document.getElementById('letter');
                let letterX, letterY;
                
                do {
                    letterX = Math.random() * 350 + 25;
                    letterY = Math.random() * 350 + 25;
                } while (letterX > squareLeft - 30 && letterX < squareRight + 30 && 
                         letterY > squareTop - 30 && letterY < squareBottom + 30);
                
                letterEl.style.left = letterX + 'px';
                letterEl.style.top = letterY + 'px';
                letterEl.textContent = gameState.currentLetter;
                letterEl.style.display = 'block';
                
                letterCount++;
                updateDisplay(); // Update display when new letter appears
            }
            
            // Show first letter immediately when game starts
            showNextLetter();
            // Then show subsequent letters every 5 seconds
            gameState.letterInterval = setInterval(showNextLetter, 5000);
        }
        
        function endGame() {
            gameState.active = false;
            clearInterval(gameState.gameTimer);
            clearInterval(gameState.letterInterval);
            cancelAnimationFrame(gameState.animationFrame);
            
            document.getElementById('letter').style.display = 'none';
            
            let resultText = `<h3>Condition ${gameState.condition} Results:</h3>`;
            resultText += `<p>Time Outside Square: ${gameState.timeOutside}ms</p>`;
            if (gameState.condition === 2) {
                resultText += `<p>Letters Completed: ${gameState.lettersCorrect}/6</p>`;
            }
            
            document.getElementById('results').innerHTML = resultText;
        }
        
        function resetExperiment() {
            gameState.active = false;
            gameState.countdownActive = false;
            gameState.condition = 0;
            gameState.dotX = 200;
            gameState.dotY = 200;
            gameState.timeOutside = 0;
            gameState.lettersCorrect = 0;
            gameState.currentLetter = '';
            gameState.countdown = 0;
            
            clearInterval(gameState.gameTimer);
            clearInterval(gameState.letterInterval);
            cancelAnimationFrame(gameState.animationFrame);
            
            document.getElementById('red-dot').style.left = '200px';
            document.getElementById('red-dot').style.top = '200px';
            document.getElementById('letter').style.display = 'none';
            document.getElementById('results').innerHTML = '';
            document.getElementById('reset-btn').style.display = 'none';
            
            updateDisplay();
        }
        
        function updateDisplay() {
            if (gameState.countdownActive) {
                document.getElementById('timer').textContent = `Starting in: ${gameState.countdown}`;
                document.getElementById('status').textContent = `Get ready for Condition ${gameState.condition}!`;
            } else if (gameState.active) {
                if (gameState.condition === 1) {
                    document.getElementById('timer').textContent = `Time: ${gameState.timeLeft}s`;
                } else {
                    document.getElementById('timer').textContent = `Letters remaining: ${6 - gameState.lettersCorrect}`;
                }
                document.getElementById('status').textContent = 
                    `Condition ${gameState.condition} | Time Outside: ${gameState.timeOutside}ms` +
                    (gameState.condition === 2 ? ` | Letters: ${gameState.lettersCorrect}/6` : '');
            } else {
                document.getElementById('timer').textContent = '';
                document.getElementById('status').textContent = '';
            }
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameState.active) return; // Only respond during active game, not countdown
            
            const speed = 5;
            
            // Arrow key controls for the dot
            switch(e.key) {
                case 'ArrowUp':
                    gameState.dotVelocityY -= speed;
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    gameState.dotVelocityY += speed;
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    gameState.dotVelocityX -= speed;
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    gameState.dotVelocityX += speed;
                    e.preventDefault();
                    break;
            }
            
            // Letter matching for condition 2
            if (gameState.condition === 2 && gameState.currentLetter) {
                if (e.key.toUpperCase() === gameState.currentLetter) {
                    gameState.lettersCorrect++;
                    gameState.currentLetter = '';
                    document.getElementById('letter').style.display = 'none';
                    
                    if (gameState.lettersCorrect >= 6) {
                        endGame();
                    }
                }
            }
        });
        
        // Initialize display
        updateDisplay();
    </script>
</body>
</html>
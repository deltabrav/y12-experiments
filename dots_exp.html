<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dot Counting Experiment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        
        .container {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 600px;
        }
        
        .group-selection {
            margin: 20px 0;
        }
        
        .group-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .group-button:hover {
            background: #0056b3;
        }
        
        .experiment-area {
            display: none;
        }
        
        .square {
            width: 378px; /* 10cm at 96 DPI */
            height: 378px;
            border: 2px solid #333;
            margin: 20px auto;
            position: relative;
            background: white;
        }
        
        .dot {
            width: 22.68px; /* 6mm at 96 DPI */
            height: 22.68px;
            background: black;
            border-radius: 50%;
            position: absolute;
        }
        
        .trial-info {
            font-size: 18px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        .countdown {
            font-size: 24px;
            color: #ff6b6b;
            margin: 20px 0;
        }
        
        .input-section {
            display: none;
            margin: 20px 0;
        }
        
        .guess-input {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 100px;
            text-align: center;
        }
        
        .submit-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-left: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .submit-button:hover {
            background: #218838;
        }
        
        .results {
            display: none;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .trial-results {
            margin: 10px 0;
        }
        
        .final-result {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
            margin-top: 20px;
        }
        
        .restart-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .restart-button:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dot Counting Experiment</h1>
        
        <div class="group-selection" id="groupSelection">
            <h2>Select Your Group</h2>
            <button class="group-button" onclick="startExperiment('A')">Group A</button>
            <button class="group-button" onclick="startExperiment('B')">Group B</button>
        </div>
        
        <div class="experiment-area" id="experimentArea">
            <div class="trial-info" id="trialInfo">Trial 1 of 5</div>
            <div class="countdown" id="countdown"></div>
            <div class="square" id="square"></div>
            
            <div class="input-section" id="inputSection">
                <p>How many dots did you see?</p>
                <input type="number" class="guess-input" id="guessInput" min="1" max="50">
                <button class="submit-button" onclick="submitGuess()">Submit</button>
            </div>
        </div>
        
        <div class="results" id="results">
            <h2>Results</h2>
            <div id="trialResults"></div>
            <div class="final-result" id="finalResult"></div>
            <button class="restart-button" onclick="restart()">Start New Experiment</button>
        </div>
    </div>

    <script>
        let currentGroup = '';
        let currentTrial = 0;
        let totalTrials = 5;
        let trialData = [];
        let countdownTimer;
        let displayTimer;
        
        function startExperiment(group) {
            currentGroup = group;
            currentTrial = 0;
            trialData = [];
            
            document.getElementById('groupSelection').style.display = 'none';
            document.getElementById('experimentArea').style.display = 'block';
            
            startTrial();
        }
        
        function startTrial() {
            currentTrial++;
            
            document.getElementById('trialInfo').textContent = `Trial ${currentTrial} of ${totalTrials}`;
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('guessInput').value = '';
            
            // Countdown
            let countdown = 3;
            document.getElementById('countdown').textContent = `Starting in ${countdown}...`;
            
            countdownTimer = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    document.getElementById('countdown').textContent = `Starting in ${countdown}...`;
                } else {
                    document.getElementById('countdown').textContent = '';
                    clearInterval(countdownTimer);
                    showDots();
                }
            }, 1000);
        }
        
        function showDots() {
            const square = document.getElementById('square');
            square.innerHTML = '';
            
            let dotCount;
            let dots = [];
            
            if (currentGroup === 'A') {
                // Group A: Random number of dots (15-30), randomly placed
                dotCount = Math.floor(Math.random() * 16) + 15; // 15-30 dots
                dots = generateRandomDots(dotCount, 378, 378);
            } else {
                // Group B: Random number of dots (15-30), clustered in center
                dotCount = Math.floor(Math.random() * 16) + 15; // 15-30 dots
                dots = generateClusteredDots(dotCount, 378, 378);
            }
            
            // Create dot elements
            dots.forEach(dot => {
                const dotElement = document.createElement('div');
                dotElement.className = 'dot';
                dotElement.style.left = dot.x + 'px';
                dotElement.style.top = dot.y + 'px';
                square.appendChild(dotElement);
            });
            
            // Store actual count for this trial
            trialData.push({ actual: dotCount, guess: null });
            
            // Hide dots after 2.5 seconds
            displayTimer = setTimeout(() => {
                square.innerHTML = '';
                document.getElementById('inputSection').style.display = 'block';
                document.getElementById('guessInput').focus();
            }, 2500);
        }
        
        function generateRandomDots(count, width, height) {
            const dots = [];
            const dotRadius = 11.34; // Half of dot diameter
            const attempts = 1000; // Maximum attempts to place each dot
            
            for (let i = 0; i < count; i++) {
                let placed = false;
                let attemptCount = 0;
                
                while (!placed && attemptCount < attempts) {
                    const x = Math.random() * (width - 2 * dotRadius);
                    const y = Math.random() * (height - 2 * dotRadius);
                    
                    // Check for overlap with existing dots
                    let overlaps = false;
                    for (let j = 0; j < dots.length; j++) {
                        const distance = Math.sqrt(Math.pow(x - dots[j].x, 2) + Math.pow(y - dots[j].y, 2));
                        if (distance < 2 * dotRadius) {
                            overlaps = true;
                            break;
                        }
                    }
                    
                    if (!overlaps) {
                        dots.push({ x, y });
                        placed = true;
                    }
                    attemptCount++;
                }
                
                // If we couldn't place the dot without overlap after many attempts, place it anyway
                if (!placed) {
                    const x = Math.random() * (width - 2 * dotRadius);
                    const y = Math.random() * (height - 2 * dotRadius);
                    dots.push({ x, y });
                }
            }
            
            return dots;
        }
        
        function generateClusteredDots(count, width, height) {
            const dots = [];
            const dotRadius = 11.34;
            const centerX = width / 2 - dotRadius;
            const centerY = height / 2 - dotRadius;
            const clusterRadius = 80; // Radius of the cluster area
            
            for (let i = 0; i < count; i++) {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 1000) {
                    // Generate position within cluster radius
                    const angle = Math.random() * 2 * Math.PI;
                    const distance = Math.random() * clusterRadius;
                    const x = centerX + distance * Math.cos(angle);
                    const y = centerY + distance * Math.sin(angle);
                    
                    // Ensure dot is within bounds
                    if (x >= 0 && x <= width - 2 * dotRadius && y >= 0 && y <= height - 2 * dotRadius) {
                        // Check for overlap
                        let overlaps = false;
                        for (let j = 0; j < dots.length; j++) {
                            const dist = Math.sqrt(Math.pow(x - dots[j].x, 2) + Math.pow(y - dots[j].y, 2));
                            if (dist < 2 * dotRadius) {
                                overlaps = true;
                                break;
                            }
                        }
                        
                        if (!overlaps) {
                            dots.push({ x, y });
                            placed = true;
                        }
                    }
                    attempts++;
                }
                
                // If we couldn't place the dot, place it at center with small random offset
                if (!placed) {
                    const x = centerX + (Math.random() - 0.5) * 20;
                    const y = centerY + (Math.random() - 0.5) * 20;
                    dots.push({ x, y });
                }
            }
            
            return dots;
        }
        
        function submitGuess() {
            const guess = parseInt(document.getElementById('guessInput').value);
            
            if (isNaN(guess) || guess < 1) {
                alert('Please enter a valid number of dots.');
                return;
            }
            
            // Store the guess
            trialData[currentTrial - 1].guess = guess;
            
            if (currentTrial < totalTrials) {
                startTrial();
            } else {
                showResults();
            }
        }
        
        function showResults() {
            document.getElementById('experimentArea').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            const trialResultsDiv = document.getElementById('trialResults');
            const finalResultDiv = document.getElementById('finalResult');
            
            let html = '';
            let totalDifference = 0;
            
            trialData.forEach((trial, index) => {
                const difference = Math.abs(trial.guess - trial.actual);
                totalDifference += difference;
                
                html += `<div class="trial-results">
                    Trial ${index + 1}: Actual: ${trial.actual}, Guess: ${trial.guess}, 
                    Difference: ${difference}
                </div>`;
            });
            
            const meanDifference = (totalDifference / totalTrials).toFixed(2);
            
            trialResultsDiv.innerHTML = html;
            finalResultDiv.innerHTML = `Mean Absolute Difference: ${meanDifference}`;
        }
        
        function restart() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('groupSelection').style.display = 'block';
            
            // Clear any running timers
            clearInterval(countdownTimer);
            clearTimeout(displayTimer);
        }
        
        // Allow Enter key to submit guess
        document.getElementById('guessInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitGuess();
            }
        });
    </script>
</body>
</html>
